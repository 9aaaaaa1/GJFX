<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title> ä¼šå‘è´¢ å¤šæ–‡ä»¶æ‰‹æœºå·å›½å®¶åˆ†æä¸å¯¹æ¯”å·¥å…· </title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: "Microsoft YaHei", sans-serif;
    background: #f5f6fa;
    padding: 30px;
  }
  h2 { color: #333; }
  input[type="file"], input[type="text"], button {
    margin: 10px 10px 20px 0;
    padding: 8px;
    font-size: 16px;
  }
  button {
    background: #409eff;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  button:hover { background: #66b1ff; }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 15px;
    background: #fff;
    box-shadow: 0 0 5px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: left;
  }
  th { background: #eee; }
  .chart-container { width: 90%; margin: 30px auto; }
  .file-section, .diff-section, .lookup-section {
    background: #fff;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .diff-section { border-left: 5px solid #409eff; }
  .lookup-section { border-left: 5px solid #67c23a; }
  #lookupResult span {
    display: inline-block;
    margin: 4px 6px;
    padding: 3px 8px;
    border-radius: 6px;
    background: #eef5ff;
  }
  .found { color: #67c23a; border: 1px solid #67c23a; background: #f0fff0; }
  .notfound { color: #f56c6c; border: 1px solid #f56c6c; background: #fff0f0; }
</style>
</head>
<body>

<h2>ğŸ“Š ä¼šå‘è´¢ å¤šæ–‡ä»¶æ‰‹æœºå·å›½å®¶åˆ†æ </h2>

<div class="lookup-section">
  <h3>ğŸ” åŒºå·æŸ¥è¯¢ï¼ˆæ”¯æŒå¤šä¸ªåŒºå·ï¼Œç©ºæ ¼æˆ–é€—å·åˆ†éš”ï¼‰</h3>
  <input type="text" id="lookupInput" placeholder="è¾“å…¥åŒºå·ï¼Œå¦‚ +86 91 234" oninput="lookupCountry()">
  <div id="lookupResult">è¯·è¾“å…¥åŒºå·è¿›è¡ŒæŸ¥è¯¢</div>
</div>

<input type="file" id="fileInput" multiple accept=".txt">
<button onclick="analyzeFiles()">å¼€å§‹åˆ†æ</button>

<div id="result"></div>
<div class="chart-container">
  <canvas id="summaryChart"></canvas>
</div>
<div id="compare"></div>

<script>
/* === å›½é™…åŒºå·è¡¨ === */
const countryCodes = {
  "1":"ç¾å›½/åŠ æ‹¿å¤§","7":"ä¿„ç½—æ–¯/å“ˆè¨å…‹æ–¯å¦","20":"åŸƒåŠ","27":"å—é","30":"å¸Œè…Š","31":"è·å…°","32":"æ¯”åˆ©æ—¶","33":"æ³•å›½","34":"è¥¿ç­ç‰™","36":"åŒˆç‰™åˆ©","39":"æ„å¤§åˆ©",
  "40":"ç½—é©¬å°¼äºš","41":"ç‘å£«","43":"å¥¥åœ°åˆ©","44":"è‹±å›½","45":"ä¸¹éº¦","46":"ç‘å…¸","47":"æŒªå¨","48":"æ³¢å…°","49":"å¾·å›½","51":"ç§˜é²","52":"å¢¨è¥¿å“¥","53":"å¤å·´",
  "54":"é˜¿æ ¹å»·","55":"å·´è¥¿","56":"æ™ºåˆ©","57":"å“¥ä¼¦æ¯”äºš","58":"å§”å†…ç‘æ‹‰","60":"é©¬æ¥è¥¿äºš","61":"æ¾³å¤§åˆ©äºš","62":"å°åº¦å°¼è¥¿äºš","63":"è²å¾‹å®¾","64":"æ–°è¥¿å…°",
  "65":"æ–°åŠ å¡","66":"æ³°å›½","81":"æ—¥æœ¬","82":"éŸ©å›½","84":"è¶Šå—","86":"ä¸­å›½","90":"åœŸè€³å…¶","91":"å°åº¦","92":"å·´åŸºæ–¯å¦","93":"é˜¿å¯Œæ±—","94":"æ–¯é‡Œå…°å¡",
  "95":"ç¼…ç”¸","98":"ä¼Šæœ—","212":"æ‘©æ´›å“¥","213":"é˜¿å°”åŠåˆ©äºš","216":"çªå°¼æ–¯","218":"åˆ©æ¯”äºš","220":"å†ˆæ¯”äºš","221":"å¡å†…åŠ å°”","222":"æ¯›é‡Œå¡”å°¼äºš",
  "223":"é©¬é‡Œ","224":"å‡ å†…äºš","225":"ç§‘ç‰¹è¿ªç“¦","226":"å¸ƒåŸºçº³æ³•ç´¢","227":"å°¼æ—¥å°”","228":"å¤šå“¥","229":"è´å®","230":"æ¯›é‡Œæ±‚æ–¯","231":"åˆ©æ¯”é‡Œäºš",
  "232":"å¡æ‹‰åˆ©æ˜‚","233":"åŠ çº³","234":"å°¼æ—¥åˆ©äºš","235":"ä¹å¾—","236":"ä¸­éå…±å’Œå›½","237":"å–€éº¦éš†","238":"ä½›å¾—è§’","239":"åœ£å¤šç¾å’Œæ™®æ—è¥¿æ¯”","240":"èµ¤é“å‡ å†…äºš",
  "241":"åŠ è“¬","242":"åˆšæœï¼ˆå¸ƒï¼‰","243":"åˆšæœï¼ˆé‡‘ï¼‰","244":"å®‰å“¥æ‹‰","245":"å‡ å†…äºšæ¯”ç»","248":"å¡èˆŒå°”","249":"è‹ä¸¹","250":"å¢æ—ºè¾¾","251":"åŸƒå¡ä¿„æ¯”äºš",
  "252":"ç´¢é©¬é‡Œ","253":"å‰å¸ƒæ","254":"è‚¯å°¼äºš","255":"å¦æ¡‘å°¼äºš","256":"ä¹Œå¹²è¾¾","257":"å¸ƒéš†è¿ª","258":"è«æ¡‘æ¯”å…‹","260":"èµæ¯”äºš","261":"é©¬è¾¾åŠ æ–¯åŠ ",
  "263":"æ´¥å·´å¸ƒéŸ¦","264":"çº³ç±³æ¯”äºš","265":"é©¬æ‹‰ç»´","266":"è±ç´¢æ‰˜","267":"åšèŒ¨ç“¦çº³","268":"æ–¯å¨å£«å…°","269":"ç§‘æ‘©ç½—","290":"åœ£èµ«å‹’æ‹¿","297":"é˜¿é²å·´",
  "298":"æ³•ç½—ç¾¤å²›","299":"æ ¼é™µå…°","350":"ç›´å¸ƒç½—é™€","351":"è‘¡è„ç‰™","352":"å¢æ£®å ¡","353":"çˆ±å°”å…°","354":"å†°å²›","355":"é˜¿å°”å·´å°¼äºš","356":"é©¬è€³ä»–",
  "357":"å¡æµ¦è·¯æ–¯","358":"èŠ¬å…°","359":"ä¿åŠ åˆ©äºš","370":"ç«‹é™¶å®›","371":"æ‹‰è„±ç»´äºš","372":"çˆ±æ²™å°¼äºš","373":"æ‘©å°”å¤šç“¦","374":"äºšç¾å°¼äºš","375":"ç™½ä¿„ç½—æ–¯",
  "376":"å®‰é“å°”","377":"æ‘©çº³å“¥","378":"åœ£é©¬åŠ›è¯º","380":"ä¹Œå…‹å…°","381":"å¡å°”ç»´äºš","382":"é»‘å±±","385":"å…‹ç½—åœ°äºš","386":"æ–¯æ´›æ–‡å°¼äºš","387":"æ³¢é»‘",
  "389":"åŒ—é©¬å…¶é¡¿","420":"æ·å…‹","421":"æ–¯æ´›ä¼å…‹","423":"åˆ—æ”¯æ•¦å£«ç™»","500":"ç¦å…‹å…°ç¾¤å²›","501":"ä¼¯åˆ©å…¹","502":"å±åœ°é©¬æ‹‰","503":"è¨å°”ç“¦å¤š","504":"æ´ªéƒ½æ‹‰æ–¯",
  "505":"å°¼åŠ æ‹‰ç“œ","506":"å“¥æ–¯è¾¾é»åŠ ","507":"å·´æ‹¿é©¬","509":"æµ·åœ°","591":"ç»åˆ©ç»´äºš","592":"åœ­äºšé‚£","593":"å„ç“œå¤šå°”","594":"æ³•å±åœ­äºšé‚£","595":"å·´æ‹‰åœ­",
  "598":"ä¹Œæ‹‰åœ­","673":"æ–‡è±","850":"æœé²œ","852":"é¦™æ¸¯","853":"æ¾³é—¨","855":"æŸ¬åŸ”å¯¨","856":"è€æŒ","880":"å­ŸåŠ æ‹‰","886":"å°æ¹¾","960":"é©¬å°”ä»£å¤«",
  "961":"é»å·´å«©","962":"çº¦æ—¦","963":"å™åˆ©äºš","964":"ä¼Šæ‹‰å…‹","965":"ç§‘å¨ç‰¹","966":"æ²™ç‰¹","967":"ä¹Ÿé—¨","968":"é˜¿æ›¼","971":"é˜¿è”é…‹","972":"ä»¥è‰²åˆ—",
  "973":"å·´æ—","974":"å¡å¡”å°”","975":"ä¸ä¸¹","976":"è’™å¤","977":"å°¼æ³Šå°”","992":"å¡”å‰å…‹æ–¯å¦","993":"åœŸåº“æ›¼æ–¯å¦","994":"é˜¿å¡æ‹œç–†","995":"æ ¼é²å‰äºš",
  "996":"å‰å°”å‰æ–¯æ–¯å¦","998":"ä¹Œå…¹åˆ«å…‹æ–¯å¦"
};

/* === å¤šåŒºå·å®æ—¶æŸ¥è¯¢ === */
function lookupCountry() {
  const input = document.getElementById("lookupInput").value.trim();
  const result = document.getElementById("lookupResult");
  if (!input) {
    result.innerHTML = "è¯·è¾“å…¥åŒºå·è¿›è¡ŒæŸ¥è¯¢";
    return;
  }

  const parts = input.split(/[\s,ï¼Œ]+/).map(p => p.replace(/^\+/, '').trim()).filter(Boolean);
  if (!parts.length) {
    result.innerHTML = "è¯·è¾“å…¥åŒºå·è¿›è¡ŒæŸ¥è¯¢";
    return;
  }

  const output = parts.map(code => {
    const country = countryCodes[code];
    if (country) {
      return `<span class="found">+${code}ï¼š${country}</span>`;
    } else {
      return `<span class="notfound">+${code}ï¼šæœªæ‰¾åˆ°</span>`;
    }
  });

  result.innerHTML = output.join(" ");
}

/* === æ–‡ä»¶åˆ†æé€»è¾‘ === */
function analyzeFiles() {
  const files = document.getElementById('fileInput').files;
  if (!files.length) return alert("è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªTXTæ–‡ä»¶ï¼");
  document.getElementById('result').innerHTML = "åˆ†æä¸­...";

  const readerPromises = [];
  for (let f of files) {
    readerPromises.push(new Promise(resolve => {
      const r = new FileReader();
      r.onload = e => resolve({name: f.name, text: e.target.result});
      r.readAsText(f, "utf-8");
    }));
  }

  Promise.all(readerPromises).then(fileData => {
    const fileResults = [];
    const totalCounts = {};

    fileData.forEach(f => {
      const phones = f.text.match(/\+?\d{6,16}/g) || [];
      const stats = {};
      phones.forEach(num => {
        const country = findCountry(num);
        if (country) {
          stats[country] = (stats[country] || 0) + 1;
          totalCounts[country] = (totalCounts[country] || 0) + 1;
        }
      });
      fileResults.push({file: f.name, stats});
    });

    renderTables(fileResults);
    renderSummaryChart(totalCounts);
    renderCompare(fileResults);
  });
}

/* === ä¼˜åŒ–ï¼šè¿”å›å¸¦åŒºå·çš„å›½å®¶å === */
function findCountry(num) {
  num = num.replace(/\D/g, '');
  for (let len = 4; len >= 1; len--) {
    const prefix = num.slice(0, len);
    if (countryCodes[prefix]) return `+${prefix} ${countryCodes[prefix]}`;
  }
  return null;
}

function renderTables(results) {
  let html = "";
  results.forEach(r => {
    html += `<div class="file-section"><h3>ğŸ“„ ${r.file}</h3><table><tr><th>å›½å®¶</th><th>æ•°é‡</th></tr>`;
    const entries = Object.entries(r.stats).sort((a,b)=>b[1]-a[1]);
    entries.forEach(([country, count]) => {
      html += `<tr><td>${country}</td><td>${count}</td></tr>`;
    });
    html += "</table></div>";
  });
  document.getElementById('result').innerHTML = html;
}

function renderSummaryChart(totalCounts) {
  const ctx = document.getElementById('summaryChart').getContext('2d');
  const labels = Object.keys(totalCounts);
  const values = Object.values(totalCounts);
  if (window.chartInstance) window.chartInstance.destroy();
  window.chartInstance = new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{ label: 'æ€»è®¡æ‰‹æœºå·æ•°é‡', data: values, backgroundColor: '#409eff' }]
    },
    options: { responsive: true, scales: { y: { beginAtZero: true } } }
  });
}

function renderCompare(results) {
  const fileCountries = {};
  results.forEach(r => fileCountries[r.file] = new Set(Object.keys(r.stats)));

  const allCountries = new Set();
  Object.values(fileCountries).forEach(set => set.forEach(c => allCountries.add(c)));

  const intersection = [...allCountries].filter(c =>
    Object.values(fileCountries).every(set => set.has(c))
  );

  let html = `<div class="diff-section"><h3>ğŸŒ å›½å®¶å¯¹æ¯”ç»“æœ</h3>`;
  html += `<h4>âœ… æ‰€æœ‰æ–‡ä»¶å…±æœ‰å›½å®¶ (${intersection.length})</h4>`;
  html += intersection.length ? intersection.join("ï¼Œ") : "æ— ";

  results.forEach(r => {
    const uniqueCountries = [...fileCountries[r.file]].filter(c =>
      !Object.values(fileCountries).some(set => set !== fileCountries[r.file] && set.has(c))
    );
    html += `<h4>ğŸ“„ ${r.file}</h4>`;
    html += `<b>ç‹¬æœ‰å›½å®¶:</b> ${uniqueCountries.length ? uniqueCountries.join("ï¼Œ") : "æ— "}<br>`;
  });

  html += `</div>`;
  document.getElementById('compare').innerHTML = html;
}
</script>
</body>
</html>

